from aiogram import Router, types, F
from bot.db.queries import delete_subscription, get_user_subscriptions
from bot.keyboards.inline_keyboards import get_subscriptions_keyboard, get_main_menu_keyboard

router = Router()

@router.callback_query(F.data.startswith("delete_sub:"))
async def delete_subscription_handler(callback: types.CallbackQuery):
    """–£–¥–∞–ª—è–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É –ø–æ –µ—ë ID"""
    subscription_id = int(callback.data.split(":")[1])
    delete_subscription(subscription_id)

    user_id = callback.from_user.id
    subscriptions = get_user_subscriptions(user_id)

    if not subscriptions:
        await callback.message.edit_text("üòï –£ –≤–∞—Å –±–æ–ª—å—à–µ –Ω–µ—Ç –ø–æ–¥–ø–∏—Å–æ–∫.", reply_markup=get_main_menu_keyboard())
        return

    await callback.message.edit_text("‚úÖ –ü–æ–¥–ø–∏—Å–∫–∞ —É–¥–∞–ª–µ–Ω–∞. –í–∞—à–∏ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –ø–æ–¥–ø–∏—Å–∫–∏:",
                                     reply_markup=get_subscriptions_keyboard(subscriptions))  # ‚ùå –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" —É–±—Ä–∞–Ω–∞

    await callback.answer()  # –£–±–∏—Ä–∞–µ—Ç "—á–∞—Å–∏–∫–∏" –≤ Telegram
