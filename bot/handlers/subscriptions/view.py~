from aiogram import Router, types, F
from bot.db.queries import get_user_subscriptions
from bot.keyboards.inline_keyboards import get_subscriptions_keyboard, get_main_menu_keyboard

router = Router()

@router.callback_query(F.data == "view_subscriptions")
async def view_subscriptions(callback: types.CallbackQuery):
    """–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–æ–¥–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    user_id = callback.from_user.id
    subscriptions = get_user_subscriptions(user_id)

    if not subscriptions:
        await callback.message.edit_text("üòï –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø–æ–¥–ø–∏—Å–æ–∫.", reply_markup=get_main_menu_keyboard())
        return

    await callback.message.edit_text(
        "üìú –í–∞—à–∏ –ø–æ–¥–ø–∏—Å–∫–∏:\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è:",
        reply_markup=get_subscriptions_keyboard(subscriptions)  # ‚ùå –£–±—Ä–∞–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥"
    )

@router.callback_query(F.data == "back_to_main")
async def back_to_main(callback: types.CallbackQuery):
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"""
    await callback.message.edit_text("üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é!", reply_markup=get_main_menu_keyboard())
    await callback.answer()
