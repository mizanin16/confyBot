from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton
from aiogram.utils.keyboard import InlineKeyboardBuilder


def add_custom_input_button(keyboard: InlineKeyboardMarkup) -> InlineKeyboardMarkup:
    """Add a 'Custom Input' button to any inline keyboard"""
    builder = InlineKeyboardBuilder()
    for row in keyboard.inline_keyboard:
        for button in row:
            builder.add(button)
    builder.adjust(len(keyboard.inline_keyboard[0]))
    builder.row(InlineKeyboardButton(
        text="✏️ Ввести своё значение",
        callback_data="custom_input"
    ))
    return builder.as_markup()

@router.callback_query(F.data == "custom_input")
async def custom_theme_input(callback: types.CallbackQuery, state: FSMContext):
    """Переключает пользователя в режим ввода своей тематики"""
    await callback.message.answer("Введите свою тематику:")
    await state.set_state(FilterStates.theme_custom)
    await callback.answer()